{"ast":null,"code":"import axios from \"axios\";\nimport { createAsyncThunk } from \"@reduxjs/toolkit\";\naxios.defaults.baseURL = \"https://connections-api.herokuapp.com\";\nfunction formatError(error) {\n  switch (error.response.data.errors.password.kind) {\n    case \"minlength\":\n      return \"Password is shorter than the minimum allowed length (7)\";\n    default:\n      return \"\";\n  }\n}\nconst token = {\n  set(token) {\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n  },\n  unset() {\n    axios.defaults.headers.common.Authorization = \"\";\n  }\n};\nconst register = createAsyncThunk(\"auth/register\", async (credentials, _ref) => {\n  let {\n    dispatch\n  } = _ref;\n  try {\n    const {\n      data\n    } = await axios.post(\"/users/signup\", credentials);\n    token.set(data.token);\n    return data;\n  } catch (error) {\n    const errorMessage = formatError(error);\n    dispatch();\n    // console.log(error.response.data.errors.password.kind);\n  }\n});\n\nconst login = createAsyncThunk(\"auth/login\", async credentials => {\n  try {\n    const {\n      data\n    } = await axios.post(\"users/login\", credentials);\n    token.set(data.token);\n    return data;\n  } catch (error) {\n    console.log(error);\n  }\n});\nconst logOut = createAsyncThunk(\"auth/logout\", async () => {\n  try {\n    await axios.post(\"/users/logout\");\n    token.unset();\n  } catch (error) {\n    console.log(error);\n  }\n});\nconst fetchCurrentUser = createAsyncThunk(\"contacts/fetchCurrentUser\", async (_, _ref2) => {\n  let {\n    getState,\n    rejectWithValue\n  } = _ref2;\n  const state = getState();\n  const persistToken = state.auth.token;\n  if (persistToken === null) {\n    return state;\n  }\n  token.set(persistToken);\n  try {\n    const {\n      data\n    } = await axios.get(\"/users/current\");\n    return data;\n  } catch (error) {\n    console.log(error);\n  }\n});\nconst operations = {\n  register,\n  login,\n  logOut,\n  fetchCurrentUser\n};\nexport default operations;","map":{"version":3,"names":["axios","createAsyncThunk","defaults","baseURL","formatError","error","response","data","errors","password","kind","token","set","headers","common","Authorization","unset","register","credentials","dispatch","post","errorMessage","login","console","log","logOut","fetchCurrentUser","_","getState","rejectWithValue","state","persistToken","auth","get","operations"],"sources":["C:/Projects/Phonebook/src/components/redux/auth/auth-operations.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { createAsyncThunk } from \"@reduxjs/toolkit\";\r\n\r\naxios.defaults.baseURL = \"https://connections-api.herokuapp.com\";\r\n\r\nfunction formatError(error) {\r\n  switch (error.response.data.errors.password.kind) {\r\n    case \"minlength\":\r\n      return \"Password is shorter than the minimum allowed length (7)\";\r\n\r\n    default:\r\n      return \"\";\r\n  }\r\n}\r\n\r\nconst token = {\r\n  set(token) {\r\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`;\r\n  },\r\n  unset() {\r\n    axios.defaults.headers.common.Authorization = \"\";\r\n  },\r\n};\r\n\r\nconst register = createAsyncThunk(\"auth/register\", async (credentials, { dispatch }) => {\r\n  try {\r\n    const { data } = await axios.post(\"/users/signup\", credentials);\r\n    token.set(data.token);\r\n    return data;\r\n  } catch (error) {\r\n    const errorMessage = formatError(error);\r\n    dispatch();\r\n    // console.log(error.response.data.errors.password.kind);\r\n  }\r\n});\r\n\r\nconst login = createAsyncThunk(\"auth/login\", async (credentials) => {\r\n  try {\r\n    const { data } = await axios.post(\"users/login\", credentials);\r\n    token.set(data.token);\r\n    return data;\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nconst logOut = createAsyncThunk(\"auth/logout\", async () => {\r\n  try {\r\n    await axios.post(\"/users/logout\");\r\n    token.unset();\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nconst fetchCurrentUser = createAsyncThunk(\r\n  \"contacts/fetchCurrentUser\",\r\n  async (_, { getState, rejectWithValue }) => {\r\n    const state = getState();\r\n    const persistToken = state.auth.token;\r\n    if (persistToken === null) {\r\n      return state;\r\n    }\r\n\r\n    token.set(persistToken);\r\n    try {\r\n      const { data } = await axios.get(\"/users/current\");\r\n      return data;\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n);\r\n\r\nconst operations = { register, login, logOut, fetchCurrentUser };\r\n\r\nexport default operations;\r\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,gBAAgB,QAAQ,kBAAkB;AAEnDD,KAAK,CAACE,QAAQ,CAACC,OAAO,GAAG,uCAAuC;AAEhE,SAASC,WAAW,CAACC,KAAK,EAAE;EAC1B,QAAQA,KAAK,CAACC,QAAQ,CAACC,IAAI,CAACC,MAAM,CAACC,QAAQ,CAACC,IAAI;IAC9C,KAAK,WAAW;MACd,OAAO,yDAAyD;IAElE;MACE,OAAO,EAAE;EAAC;AAEhB;AAEA,MAAMC,KAAK,GAAG;EACZC,GAAG,CAACD,KAAK,EAAE;IACTX,KAAK,CAACE,QAAQ,CAACW,OAAO,CAACC,MAAM,CAACC,aAAa,GAAI,UAASJ,KAAM,EAAC;EACjE,CAAC;EACDK,KAAK,GAAG;IACNhB,KAAK,CAACE,QAAQ,CAACW,OAAO,CAACC,MAAM,CAACC,aAAa,GAAG,EAAE;EAClD;AACF,CAAC;AAED,MAAME,QAAQ,GAAGhB,gBAAgB,CAAC,eAAe,EAAE,OAAOiB,WAAW,WAAmB;EAAA,IAAjB;IAAEC;EAAS,CAAC;EACjF,IAAI;IACF,MAAM;MAAEZ;IAAK,CAAC,GAAG,MAAMP,KAAK,CAACoB,IAAI,CAAC,eAAe,EAAEF,WAAW,CAAC;IAC/DP,KAAK,CAACC,GAAG,CAACL,IAAI,CAACI,KAAK,CAAC;IACrB,OAAOJ,IAAI;EACb,CAAC,CAAC,OAAOF,KAAK,EAAE;IACd,MAAMgB,YAAY,GAAGjB,WAAW,CAACC,KAAK,CAAC;IACvCc,QAAQ,EAAE;IACV;EACF;AACF,CAAC,CAAC;;AAEF,MAAMG,KAAK,GAAGrB,gBAAgB,CAAC,YAAY,EAAE,MAAOiB,WAAW,IAAK;EAClE,IAAI;IACF,MAAM;MAAEX;IAAK,CAAC,GAAG,MAAMP,KAAK,CAACoB,IAAI,CAAC,aAAa,EAAEF,WAAW,CAAC;IAC7DP,KAAK,CAACC,GAAG,CAACL,IAAI,CAACI,KAAK,CAAC;IACrB,OAAOJ,IAAI;EACb,CAAC,CAAC,OAAOF,KAAK,EAAE;IACdkB,OAAO,CAACC,GAAG,CAACnB,KAAK,CAAC;EACpB;AACF,CAAC,CAAC;AAEF,MAAMoB,MAAM,GAAGxB,gBAAgB,CAAC,aAAa,EAAE,YAAY;EACzD,IAAI;IACF,MAAMD,KAAK,CAACoB,IAAI,CAAC,eAAe,CAAC;IACjCT,KAAK,CAACK,KAAK,EAAE;EACf,CAAC,CAAC,OAAOX,KAAK,EAAE;IACdkB,OAAO,CAACC,GAAG,CAACnB,KAAK,CAAC;EACpB;AACF,CAAC,CAAC;AAEF,MAAMqB,gBAAgB,GAAGzB,gBAAgB,CACvC,2BAA2B,EAC3B,OAAO0B,CAAC,YAAoC;EAAA,IAAlC;IAAEC,QAAQ;IAAEC;EAAgB,CAAC;EACrC,MAAMC,KAAK,GAAGF,QAAQ,EAAE;EACxB,MAAMG,YAAY,GAAGD,KAAK,CAACE,IAAI,CAACrB,KAAK;EACrC,IAAIoB,YAAY,KAAK,IAAI,EAAE;IACzB,OAAOD,KAAK;EACd;EAEAnB,KAAK,CAACC,GAAG,CAACmB,YAAY,CAAC;EACvB,IAAI;IACF,MAAM;MAAExB;IAAK,CAAC,GAAG,MAAMP,KAAK,CAACiC,GAAG,CAAC,gBAAgB,CAAC;IAClD,OAAO1B,IAAI;EACb,CAAC,CAAC,OAAOF,KAAK,EAAE;IACdkB,OAAO,CAACC,GAAG,CAACnB,KAAK,CAAC;EACpB;AACF,CAAC,CACF;AAED,MAAM6B,UAAU,GAAG;EAAEjB,QAAQ;EAAEK,KAAK;EAAEG,MAAM;EAAEC;AAAiB,CAAC;AAEhE,eAAeQ,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}