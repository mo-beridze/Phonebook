{"ast":null,"code":"import _regeneratorRuntime from\"C:/Projects/Phonebook/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Projects/Phonebook/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from\"axios\";import{createAsyncThunk}from\"@reduxjs/toolkit\";import{errorMessageSignup}from\"./auth-slice\";axios.defaults.baseURL=\"https://connections-api.herokuapp.com\";function formatError(error){switch(error.response.data.errors.password.kind){case\"minlength\":return\"Password is shorter\";default:return\"\";}}var token={set:function set(token){axios.defaults.headers.common.Authorization=\"Bearer \".concat(token);},unset:function unset(){axios.defaults.headers.common.Authorization=\"\";}};var register=createAsyncThunk(\"auth/register\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(credentials,_ref){var dispatch,_yield$axios$post,data,errorMessage;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch=_ref.dispatch;_context.prev=1;_context.next=4;return axios.post(\"/users/signup\",credentials);case 4:_yield$axios$post=_context.sent;data=_yield$axios$post.data;token.set(data.token);return _context.abrupt(\"return\",data);case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);errorMessage=formatError(_context.t0);dispatch(errorMessageSignup(errorMessage));case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());var login=createAsyncThunk(\"auth/login\",/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(credentials){var _yield$axios$post2,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"users/login\",credentials);case 3:_yield$axios$post2=_context2.sent;data=_yield$axios$post2.data;token.set(data.token);return _context2.abrupt(\"return\",data);case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function(_x3){return _ref3.apply(this,arguments);};}());var logOut=createAsyncThunk(\"auth/logout\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.post(\"/users/logout\");case 3:token.unset();_context3.next=9;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 9:case\"end\":return _context3.stop();}}},_callee3,null,[[0,6]]);})));var fetchCurrentUser=createAsyncThunk(\"contacts/fetchCurrentUser\",/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(_,_ref5){var getState,rejectWithValue,state,persistToken,_yield$axios$get,data;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:getState=_ref5.getState,rejectWithValue=_ref5.rejectWithValue;state=getState();persistToken=state.auth.token;if(!(persistToken===null)){_context4.next=5;break;}return _context4.abrupt(\"return\",state);case 5:token.set(persistToken);_context4.prev=6;_context4.next=9;return axios.get(\"/users/current\");case 9:_yield$axios$get=_context4.sent;data=_yield$axios$get.data;return _context4.abrupt(\"return\",data);case 14:_context4.prev=14;_context4.t0=_context4[\"catch\"](6);console.log(_context4.t0);case 17:case\"end\":return _context4.stop();}}},_callee4,null,[[6,14]]);}));return function(_x4,_x5){return _ref6.apply(this,arguments);};}());var operations={register:register,login:login,logOut:logOut,fetchCurrentUser:fetchCurrentUser};export default operations;","map":{"version":3,"names":["axios","createAsyncThunk","errorMessageSignup","defaults","baseURL","formatError","error","response","data","errors","password","kind","token","set","headers","common","Authorization","unset","register","credentials","dispatch","post","errorMessage","login","console","log","logOut","fetchCurrentUser","_","getState","rejectWithValue","state","persistToken","auth","get","operations"],"sources":["C:/Projects/Phonebook/src/components/redux/auth/auth-operations.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { createAsyncThunk } from \"@reduxjs/toolkit\";\r\nimport { errorMessageSignup } from \"./auth-slice\";\r\n\r\naxios.defaults.baseURL = \"https://connections-api.herokuapp.com\";\r\n\r\nfunction formatError(error) {\r\n  switch (error.response.data.errors.password.kind) {\r\n    case \"minlength\":\r\n      return \"Password is shorter\";\r\n\r\n    default:\r\n      return \"\";\r\n  }\r\n}\r\n\r\nconst token = {\r\n  set(token) {\r\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`;\r\n  },\r\n  unset() {\r\n    axios.defaults.headers.common.Authorization = \"\";\r\n  },\r\n};\r\n\r\nconst register = createAsyncThunk(\"auth/register\", async (credentials, { dispatch }) => {\r\n  try {\r\n    const { data } = await axios.post(\"/users/signup\", credentials);\r\n    token.set(data.token);\r\n    return data;\r\n  } catch (error) {\r\n    const errorMessage = formatError(error);\r\n    dispatch(errorMessageSignup(errorMessage));\r\n  }\r\n});\r\n\r\nconst login = createAsyncThunk(\"auth/login\", async (credentials) => {\r\n  try {\r\n    const { data } = await axios.post(\"users/login\", credentials);\r\n    token.set(data.token);\r\n    return data;\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nconst logOut = createAsyncThunk(\"auth/logout\", async () => {\r\n  try {\r\n    await axios.post(\"/users/logout\");\r\n    token.unset();\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nconst fetchCurrentUser = createAsyncThunk(\r\n  \"contacts/fetchCurrentUser\",\r\n  async (_, { getState, rejectWithValue }) => {\r\n    const state = getState();\r\n    const persistToken = state.auth.token;\r\n    if (persistToken === null) {\r\n      return state;\r\n    }\r\n\r\n    token.set(persistToken);\r\n    try {\r\n      const { data } = await axios.get(\"/users/current\");\r\n      return data;\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n);\r\n\r\nconst operations = { register, login, logOut, fetchCurrentUser };\r\n\r\nexport default operations;\r\n"],"mappings":"sOAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,OAASC,gBAAgB,KAAQ,kBAAkB,CACnD,OAASC,kBAAkB,KAAQ,cAAc,CAEjDF,KAAK,CAACG,QAAQ,CAACC,OAAO,CAAG,uCAAuC,CAEhE,QAASC,YAAW,CAACC,KAAK,CAAE,CAC1B,OAAQA,KAAK,CAACC,QAAQ,CAACC,IAAI,CAACC,MAAM,CAACC,QAAQ,CAACC,IAAI,EAC9C,IAAK,WAAW,CACd,MAAO,qBAAqB,CAE9B,QACE,MAAO,EAAE,CAAC,CAEhB,CAEA,GAAMC,MAAK,CAAG,CACZC,GAAG,cAACD,KAAK,CAAE,CACTZ,KAAK,CAACG,QAAQ,CAACW,OAAO,CAACC,MAAM,CAACC,aAAa,kBAAaJ,KAAK,CAAE,CACjE,CAAC,CACDK,KAAK,iBAAG,CACNjB,KAAK,CAACG,QAAQ,CAACW,OAAO,CAACC,MAAM,CAACC,aAAa,CAAG,EAAE,CAClD,CACF,CAAC,CAED,GAAME,SAAQ,CAAGjB,gBAAgB,CAAC,eAAe,6FAAE,iBAAOkB,WAAW,0KAAIC,QAAQ,MAARA,QAAQ,uCAEtDpB,MAAK,CAACqB,IAAI,CAAC,eAAe,CAAEF,WAAW,CAAC,wCAAvDX,IAAI,mBAAJA,IAAI,CACZI,KAAK,CAACC,GAAG,CAACL,IAAI,CAACI,KAAK,CAAC,CAAC,gCACfJ,IAAI,4DAELc,YAAY,CAAGjB,WAAW,aAAO,CACvCe,QAAQ,CAAClB,kBAAkB,CAACoB,YAAY,CAAC,CAAC,CAAC,qEAE9C,oEAAC,CAEF,GAAMC,MAAK,CAAGtB,gBAAgB,CAAC,YAAY,6FAAE,kBAAOkB,WAAW,4LAEpCnB,MAAK,CAACqB,IAAI,CAAC,aAAa,CAAEF,WAAW,CAAC,0CAArDX,IAAI,oBAAJA,IAAI,CACZI,KAAK,CAACC,GAAG,CAACL,IAAI,CAACI,KAAK,CAAC,CAAC,iCACfJ,IAAI,6DAEXgB,OAAO,CAACC,GAAG,cAAO,CAAC,sEAEtB,iEAAC,CAEF,GAAMC,OAAM,CAAGzB,gBAAgB,CAAC,aAAa,wEAAE,kLAErCD,MAAK,CAACqB,IAAI,CAAC,eAAe,CAAC,QACjCT,KAAK,CAACK,KAAK,EAAE,CAAC,kFAEdO,OAAO,CAACC,GAAG,cAAO,CAAC,qEAEtB,GAAC,CAEF,GAAME,iBAAgB,CAAG1B,gBAAgB,CACvC,2BAA2B,6FAC3B,kBAAO2B,CAAC,oMAAIC,QAAQ,OAARA,QAAQ,CAAEC,eAAe,OAAfA,eAAe,CAC7BC,KAAK,CAAGF,QAAQ,EAAE,CAClBG,YAAY,CAAGD,KAAK,CAACE,IAAI,CAACrB,KAAK,MACjCoB,YAAY,GAAK,IAAI,4DAChBD,KAAK,SAGdnB,KAAK,CAACC,GAAG,CAACmB,YAAY,CAAC,CAAC,wCAEChC,MAAK,CAACkC,GAAG,CAAC,gBAAgB,CAAC,wCAA1C1B,IAAI,kBAAJA,IAAI,kCACLA,IAAI,+DAEXgB,OAAO,CAACC,GAAG,cAAO,CAAC,uEAEtB,qEACF,CAED,GAAMU,WAAU,CAAG,CAAEjB,QAAQ,CAARA,QAAQ,CAAEK,KAAK,CAALA,KAAK,CAAEG,MAAM,CAANA,MAAM,CAAEC,gBAAgB,CAAhBA,gBAAiB,CAAC,CAEhE,cAAeQ,WAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}